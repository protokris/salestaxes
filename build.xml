<project name="SalesTaxes" default="run" basedir=".">

	<description>
        Simple build file.
    </description>

  <property name="src" location="src"/>
  <property name="test" location="test"/>
  <property name="build" location="bin"/>
  <property name="dist"  location="dist"/>
  <property name="lib"  location="lib"/>
	
  <path id="java.classpath">
  	<fileset dir="${lib}" includes="**/*.jar"/>
  </path>

  <path id="test.classpath">
  	<fileset dir="${lib}" includes="**/*.jar"/>
  	<pathelement location="${build}" />
  </path>

	
  <path id="cobertura.classpath">
	    <fileset dir="${lib}">
	        <include name="*.jar" />
	    </fileset>
  </path>
	
  <property name="cobertura.dir" value="${lib}" />
  <taskdef classpathref="cobertura.classpath" resource="tasks.properties" />	
	
	
  <target name="init">
    <tstamp/>
    <mkdir dir="${build}"/>
  </target>

  <target name="compile" depends="clean,init" description="compile the source " >
    <javac srcdir="${src}" destdir="${build}" classpathref="java.classpath" debug="true"/>
    <javac srcdir="${test}" destdir="${build}"  classpathref="java.classpath" debug="true"/>
  	<copy todir="${build}">
  	   <fileset dir="${src}" includes="**/*.properties"/>
  	</copy>
  </target>

  <target name="clean" description="clean up" >
    <delete dir="${build}"/>
    <delete dir="${dist}"/>
  </target>

  <target name="instrument-coverage" description="modify classes to include coverage" depends="compile">
  	<delete file="cobertura.ser" />
  	<cobertura-instrument todir="${build}">
  	    <fileset dir="${build}">
  	        <include name="**/*.class" />
  	        <exclude name="**/*Test.class" />
  	        <exclude name="**/*Tests.class" />
  	        <exclude name="**/Mock*.class" />
            <exclude name="**/Messages.class" />
            <exclude name="**/*RuntimeException.class" />
  	    </fileset>
  	</cobertura-instrument>
  </target>
	
  <target name="coverage" depends="instrument-coverage" description="generate test coverage" >
 	<property name="test.class.name" value="kdr.resume.salestaxes.AllTests"/>  	
  	
  	<junit fork="yes" haltonfailure="yes">
  		<sysproperty key="net.sourceforge.cobertura.datafile"
  				file="${basedir}/cobertura.ser" />
  		<classpath refid="cobertura.classpath" />
  		
  	    <test name="${test.class.name}" />
  	    <formatter type="plain" usefile="false" />
  	    <classpath refid="test.classpath" />
    </junit>

  	<delete dir="coverage"/>
  	<mkdir dir="coverage"/>
	<cobertura-report format="html" destdir="coverage" >
	    <fileset dir="${src}">
	        <include name="**/*.java" />
	    </fileset>
	</cobertura-report>
  </target>
	
  <target name="test" depends="compile" description="run all of the tests" >
 	<property name="test.class.name" value="kdr.resume.salestaxes.AllTests"/>  	
  	
  	<junit fork="yes" haltonfailure="yes">
  	    <test name="${test.class.name}" />
  	    <formatter type="plain" usefile="false" />
  	    <classpath refid="test.classpath" />
    </junit>
  </target>

  <target name="run" depends="compile" description="run the program">
 	<property name="test.class.name" value="kdr.resume.salestaxes.InputTest"/>  	
  	
  	<junit fork="yes" haltonfailure="yes">
  	    <test name="${test.class.name}" />
  	    <formatter type="plain" usefile="false" />
  	    <classpath refid="test.classpath" />
    </junit>
  	
  </target>
	
  <target name="zip" depends="compile" description="prepare to submit">   
  	<zip destfile="../Kris-Read-SalesTaxes.zip" basedir=".." includes="SalesTaxes/**/*.*"/>
  </target>

  <!-- Javadoc target Generated by Eclipse -->
  <target name="javadoc">
  	<delete dir="doc"/>
    <mkdir dir="doc"/>
    <javadoc access="public" author="true" classpath="lib/junit.jar" destdir="doc" doctitle="Sales Taxes API" nodeprecated="false" nodeprecatedlist="false" noindex="false" nonavbar="false" notree="false" packagenames="kdr.resume.salestaxes.exceptions" source="5" sourcefiles="src/kdr/resume/salestaxes/tax/NickelRoundedRateTax.java,src/kdr/resume/salestaxes/tax/ImportTax.java,src/kdr/resume/salestaxes/tax/list/TaxList.java,src/kdr/resume/salestaxes/receipt/DefaultReceipt.java,src/kdr/resume/salestaxes/tax/RoundedRateTax.java,src/kdr/resume/salestaxes/tax/Tax.java,src/kdr/resume/salestaxes/receipt/Messages.java,src/kdr/resume/salestaxes/item/factory/ItemFactory.java,src/kdr/resume/salestaxes/tax/list/DefaultTaxList.java,src/kdr/resume/salestaxes/item/Item.java,src/kdr/resume/salestaxes/receipt/Receipt.java,src/kdr/resume/salestaxes/tax/RateTax.java,src/kdr/resume/salestaxes/item/DefaultItem.java,src/kdr/resume/salestaxes/store/Store.java,src/kdr/resume/salestaxes/money/Money.java,src/kdr/resume/salestaxes/tax/SalesTax.java" sourcepath="src;test" splitindex="true" use="true" version="true"/>
  </target>
	
	
</project>
